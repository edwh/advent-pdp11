#!/usr/bin/expect -f
# Complete test of ADVENT game

set timeout 60
log_user 1

spawn nc localhost 2323

expect "Connected to the PDP-11 simulator DZ device"
sleep 2
send "\r"

expect "User:"
send "\[1,2\]\r"

expect -re "\[Pp\]assword"
send "Digital1977\r"

expect {
    "Job number to attach to?" {
        send "\r"
    }
    -re {\$} {}
}

expect -re {\$}

puts "\n\n========== STARTING ADVENT =========="
send "RUN ADVENT\r"

# Wait for game to start
sleep 5
expect {
    "No character loaded" {
        puts "\nCharacter creation triggered - GOOD"
    }
    ">" {
        puts "\nGot game prompt - GOOD"
    }
    timeout {
        puts "\nTimeout starting game"
    }
}

# Wait for room description to complete
sleep 3

puts "\n\n========== TESTING LOOK COMMAND =========="
send "LOOK\r"
sleep 3
expect {
    -re "standing|cavern|exit|Exits" {
        puts "\nLOOK command successful - GOOD"
    }
    timeout {
        puts "\nLOOK command timeout"
    }
}

puts "\n\n========== TESTING NORTH COMMAND =========="
send "NORTH\r"
sleep 3
expect {
    -re "standing|cavern|exit|Exits|can't" {
        puts "\nNORTH command executed - GOOD"
    }
    timeout {
        puts "\nNORTH command timeout"
    }
}

puts "\n\n========== TESTING SOUTH COMMAND =========="
send "SOUTH\r"
sleep 3
expect {
    -re "standing|cavern|exit|Exits|can't" {
        puts "\nSOUTH command executed - GOOD"
    }
    timeout {
        puts "\nSOUTH command timeout"
    }
}

puts "\n\n========== TEST COMPLETE =========="
puts "The full ADVENT game is working!"

# Exit the game and session
send "\003"
sleep 2
send "BYE\r"

expect eof
